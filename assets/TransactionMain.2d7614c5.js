import{c as Pe,K as at,L as lt,a as N,b as Y,N as ot,g as We,aQ as nt,r as B,w as oe,S as rt,bh as st,bi as Ue,an as Ge,D as De,o as Xe,aE as it,ar as Re,af as ct,A as ut,f as Q,j as K,_ as dt,B as ft,u as vt,ab as Qe,b7 as mt,k as p,m as f,bj as Oe,v as ge,a2 as Te,a3 as ee,q as H,bc as Me,G as R,Q as Ye,Y as pt,W as Fe,s as F,b4 as Ne,E as G,F as St,H as $e,a0 as yt,a1 as bt,n as te,aa as ht,t as E,b2 as ze,bd as Ie,bk as se}from"./index.46a27899.js";import{Q as Ke,a as ae}from"./QItemLabel.0564320f.js";import{A as _t,Q as gt}from"./AccountDetail.87de9822.js";import{f as wt,Q as Le,u as kt,a as xt,b as Tt,d as Mt}from"./transaction.8e31b849.js";import{r as Ve,a as zt,Q as At,d as qt}from"./QToolbar.3af662a7.js";import{Q as Et,a as ie}from"./QPageSticky.81a02079.js";import{Q as Vt}from"./QPage.7824d0da.js";import{C as He}from"./ClosePopup.084ab801.js";import{u as Dt}from"./use-quasar.20dd07d7.js";import{a as X,m as Ae,b as j}from"./currency.9051c79a.js";import{d as ce,a as Bt}from"./dayjs.25ede11f.js";import{u as Ct}from"./layout.ddc5d6ce.js";import{u as Rt,A as Qt}from"./account.00e1e43f.js";import{a as Je,g as Ot,T as qe,d as Yt,b as le}from"./transaction.45dcaa38.js";import"./QSlideTransition.69f0c632.js";import"./QResizeObserver.5ab78c49.js";import"./use-page-sticky.f7fef31c.js";import"./currency.es.c7e1cdbb.js";import"./_commonjsHelpers.2cf1d77b.js";import"./account-group.879321a1.js";import"./account-group.3c4ddb1d.js";const Ft=["horizontal","vertical","cell","none"];var Nt=Pe({name:"QMarkupTable",props:{...at,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:l=>Ft.includes(l)}},setup(l,{slots:c}){const w=We(),d=lt(l,w.proxy.$q),x=N(()=>`q-markup-table q-table__container q-table__card q-table--${l.separator}-separator`+(d.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(l.dense===!0?" q-table--dense":"")+(l.flat===!0?" q-table--flat":"")+(l.bordered===!0?" q-table--bordered":"")+(l.square===!0?" q-table--square":"")+(l.wrapCells===!1?" q-table--no-wrap":""));return()=>Y("div",{class:x.value},[Y("table",{class:"q-table"},ot(c.default))])}});function $t(l,c){return Y("div",l,[Y("table",{class:"q-table"},c)])}const P=1e3,It=["start","center","end","start-force","center-force","end-force"],Ze=Array.prototype.filter,Lt=window.getComputedStyle(document.body).overflowAnchor===void 0?nt:function(l,c){l!==null&&(l._qOverflowAnimationFrame!==void 0&&cancelAnimationFrame(l._qOverflowAnimationFrame),l._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(l===null)return;l._qOverflowAnimationFrame=void 0;const w=l.children||[];Ze.call(w,x=>x.dataset&&x.dataset.qVsAnchor!==void 0).forEach(x=>{delete x.dataset.qVsAnchor});const d=w[c];d&&d.dataset&&(d.dataset.qVsAnchor="")}))};function ue(l,c){return l+c}function Ee(l,c,w,d,x,i,q,V){const u=l===window?document.scrollingElement||document.documentElement:l,z=x===!0?"offsetWidth":"offsetHeight",s={scrollStart:0,scrollViewSize:-q-V,scrollMaxSize:0,offsetStart:-q,offsetEnd:-V};if(x===!0?(l===window?(s.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,s.scrollViewSize+=document.documentElement.clientWidth):(s.scrollStart=u.scrollLeft,s.scrollViewSize+=u.clientWidth),s.scrollMaxSize=u.scrollWidth,i===!0&&(s.scrollStart=(Ve===!0?s.scrollMaxSize-s.scrollViewSize:0)-s.scrollStart)):(l===window?(s.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,s.scrollViewSize+=document.documentElement.clientHeight):(s.scrollStart=u.scrollTop,s.scrollViewSize+=u.clientHeight),s.scrollMaxSize=u.scrollHeight),w!==null)for(let g=w.previousElementSibling;g!==null;g=g.previousElementSibling)g.classList.contains("q-virtual-scroll--skip")===!1&&(s.offsetStart+=g[z]);if(d!==null)for(let g=d.nextElementSibling;g!==null;g=g.nextElementSibling)g.classList.contains("q-virtual-scroll--skip")===!1&&(s.offsetEnd+=g[z]);if(c!==l){const g=u.getBoundingClientRect(),b=c.getBoundingClientRect();x===!0?(s.offsetStart+=b.left-g.left,s.offsetEnd-=b.width):(s.offsetStart+=b.top-g.top,s.offsetEnd-=b.height),l!==window&&(s.offsetStart+=s.scrollStart),s.offsetEnd+=s.scrollMaxSize-s.offsetStart}return s}function je(l,c,w,d){c==="end"&&(c=(l===window?document.body:l)[w===!0?"scrollWidth":"scrollHeight"]),l===window?w===!0?(d===!0&&(c=(Ve===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-c),window.scrollTo(c,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,c):w===!0?(d===!0&&(c=(Ve===!0?l.scrollWidth-l.offsetWidth:0)-c),l.scrollLeft=c):l.scrollTop=c}function ve(l,c,w,d){if(w>=d)return 0;const x=c.length,i=Math.floor(w/P),q=Math.floor((d-1)/P)+1;let V=l.slice(i,q).reduce(ue,0);return w%P!==0&&(V-=c.slice(i*P,w).reduce(ue,0)),d%P!==0&&d!==x&&(V-=c.slice(d,q*P).reduce(ue,0)),V}const Ht={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},jt={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...Ht};function Pt({virtualScrollLength:l,getVirtualScrollTarget:c,getVirtualScrollEl:w,virtualScrollItemSizeComputed:d}){const x=We(),{props:i,emit:q,proxy:V}=x,{$q:u}=V;let z,s,g,b=[],k;const A=B(0),$=B(0),I=B({}),L=B(null),C=B(null),D=B(null),T=B({from:0,to:0}),J=N(()=>i.tableColspan!==void 0?i.tableColspan:100);d===void 0&&(d=N(()=>i.virtualScrollItemSize));const me=N(()=>d.value+";"+i.virtualScrollHorizontal),pe=N(()=>me.value+";"+i.virtualScrollSliceRatioBefore+";"+i.virtualScrollSliceRatioAfter);oe(pe,()=>{a()}),oe(me,de);function de(){fe(s,!0)}function Se(e){fe(e===void 0?s:e)}function ne(e,n){const o=c();if(o==null||o.nodeType===8)return;const _=Ee(o,w(),L.value,C.value,i.virtualScrollHorizontal,u.lang.rtl,i.virtualScrollStickySizeStart,i.virtualScrollStickySizeEnd);g!==_.scrollViewSize&&a(_.scrollViewSize),re(o,_,Math.min(l.value-1,Math.max(0,parseInt(e,10)||0)),0,It.indexOf(n)>-1?n:s>-1&&e>s?"end":"start")}function we(){const e=c();if(e==null||e.nodeType===8)return;const n=Ee(e,w(),L.value,C.value,i.virtualScrollHorizontal,u.lang.rtl,i.virtualScrollStickySizeStart,i.virtualScrollStickySizeEnd),o=l.value-1,_=n.scrollMaxSize-n.offsetStart-n.offsetEnd-$.value;if(z===n.scrollStart)return;if(n.scrollMaxSize<=0){re(e,n,0,0);return}g!==n.scrollViewSize&&a(n.scrollViewSize),U(T.value.from);const M=Math.floor(n.scrollMaxSize-Math.max(n.scrollViewSize,n.offsetEnd)-Math.min(k[o],n.scrollViewSize/2));if(M>0&&Math.ceil(n.scrollStart)>=M){re(e,n,o,n.scrollMaxSize-n.offsetEnd-b.reduce(ue,0));return}let m=0,y=n.scrollStart-n.offsetStart,O=y;if(y<=_&&y+n.scrollViewSize>=A.value)y-=A.value,m=T.value.from,O=y;else for(let h=0;y>=b[h]&&m<o;h++)y-=b[h],m+=P;for(;y>0&&m<o;)y-=k[m],y>-n.scrollViewSize?(m++,O=y):O=k[m]+y;re(e,n,m,O)}function re(e,n,o,_,M){const m=typeof M=="string"&&M.indexOf("-force")>-1,y=m===!0?M.replace("-force",""):M,O=y!==void 0?y:"start";let h=Math.max(0,o-I.value[O]),W=h+I.value.total;W>l.value&&(W=l.value,h=Math.max(0,W-I.value.total)),z=n.scrollStart;const be=h!==T.value.from||W!==T.value.to;if(be===!1&&y===void 0){r(o);return}const{activeElement:Be}=document,Z=D.value;be===!0&&Z!==null&&Z!==Be&&Z.contains(Be)===!0&&(Z.addEventListener("focusout",ye),setTimeout(()=>{Z!==null&&Z.removeEventListener("focusout",ye)})),Lt(Z,o-h);const et=y!==void 0?k.slice(h,o).reduce(ue,0):0;if(be===!0){const he=W>=T.value.from&&h<=T.value.to?T.value.to:W;T.value={from:h,to:he},A.value=ve(b,k,0,h),$.value=ve(b,k,W,l.value),requestAnimationFrame(()=>{T.value.to!==W&&z===n.scrollStart&&(T.value={from:T.value.from,to:W},$.value=ve(b,k,W,l.value))})}requestAnimationFrame(()=>{if(z!==n.scrollStart)return;be===!0&&U(h);const he=k.slice(h,o).reduce(ue,0),_e=he+n.offsetStart+A.value,Ce=_e+k[o];let ke=_e+_;if(y!==void 0){const tt=he-et,xe=n.scrollStart+tt;ke=m!==!0&&xe<_e&&Ce<xe+n.scrollViewSize?xe:y==="end"?Ce-n.scrollViewSize:_e-(y==="start"?0:Math.round((n.scrollViewSize-k[o])/2))}z=ke,je(e,ke,i.virtualScrollHorizontal,u.lang.rtl),r(o)})}function U(e){const n=D.value;if(n){const o=Ze.call(n.children,h=>h.classList&&h.classList.contains("q-virtual-scroll--skip")===!1),_=o.length,M=i.virtualScrollHorizontal===!0?h=>h.getBoundingClientRect().width:h=>h.offsetHeight;let m=e,y,O;for(let h=0;h<_;){for(y=M(o[h]),h++;h<_&&o[h].classList.contains("q-virtual-scroll--with-prev")===!0;)y+=M(o[h]),h++;O=y-k[m],O!==0&&(k[m]+=O,b[Math.floor(m/P)]+=O),m++}}}function ye(){D.value!==null&&D.value!==void 0&&D.value.focus()}function fe(e,n){const o=1*d.value;(n===!0||Array.isArray(k)===!1)&&(k=[]);const _=k.length;k.length=l.value;for(let m=l.value-1;m>=_;m--)k[m]=o;const M=Math.floor((l.value-1)/P);b=[];for(let m=0;m<=M;m++){let y=0;const O=Math.min((m+1)*P,l.value);for(let h=m*P;h<O;h++)y+=k[h];b.push(y)}s=-1,z=void 0,A.value=ve(b,k,0,T.value.from),$.value=ve(b,k,T.value.to,l.value),e>=0?(U(T.value.from),rt(()=>{ne(e)})):v()}function a(e){if(e===void 0&&typeof window!="undefined"){const y=c();y!=null&&y.nodeType!==8&&(e=Ee(y,w(),L.value,C.value,i.virtualScrollHorizontal,u.lang.rtl,i.virtualScrollStickySizeStart,i.virtualScrollStickySizeEnd).scrollViewSize)}g=e;const n=parseFloat(i.virtualScrollSliceRatioBefore)||0,o=parseFloat(i.virtualScrollSliceRatioAfter)||0,_=1+n+o,M=e===void 0||e<=0?1:Math.ceil(e/d.value),m=Math.max(1,M,Math.ceil((i.virtualScrollSliceSize>0?i.virtualScrollSliceSize:10)/_));I.value={total:Math.ceil(m*_),start:Math.ceil(m*n),center:Math.ceil(m*(.5+n)),end:Math.ceil(m*(1+n)),view:M}}function t(e,n){const o=i.virtualScrollHorizontal===!0?"width":"height",_={["--q-virtual-scroll-item-"+o]:d.value+"px"};return[e==="tbody"?Y(e,{class:"q-virtual-scroll__padding",key:"before",ref:L},[Y("tr",[Y("td",{style:{[o]:`${A.value}px`,..._},colspan:J.value})])]):Y(e,{class:"q-virtual-scroll__padding",key:"before",ref:L,style:{[o]:`${A.value}px`,..._}}),Y(e,{class:"q-virtual-scroll__content",key:"content",ref:D,tabindex:-1},n.flat()),e==="tbody"?Y(e,{class:"q-virtual-scroll__padding",key:"after",ref:C},[Y("tr",[Y("td",{style:{[o]:`${$.value}px`,..._},colspan:J.value})])]):Y(e,{class:"q-virtual-scroll__padding",key:"after",ref:C,style:{[o]:`${$.value}px`,..._}})]}function r(e){s!==e&&(i.onVirtualScroll!==void 0&&q("virtualScroll",{index:e,from:T.value.from,to:T.value.to-1,direction:e<s?"decrease":"increase",ref:V}),s=e)}a();const v=st(we,u.platform.is.ios===!0?120:35);Ue(()=>{a()});let S=!1;return Ge(()=>{S=!0}),De(()=>{if(S!==!0)return;const e=c();z!==void 0&&e!==void 0&&e!==null&&e.nodeType!==8?je(e,z,i.virtualScrollHorizontal,u.lang.rtl):ne(s)}),Xe(()=>{v.cancel()}),Object.assign(V,{scrollTo:ne,reset:de,refresh:Se}),{virtualScrollSliceRange:T,virtualScrollSliceSizeComputed:I,setVirtualScrollSize:a,onVirtualScrollEvt:v,localResetVirtualScroll:fe,padVirtualScroll:t,scrollTo:ne,reset:de,refresh:Se}}const Wt={list:Ke,table:Nt},Ut=["list","table","__qtable"];var Gt=Pe({name:"QVirtualScroll",props:{...jt,type:{type:String,default:"list",validator:l=>Ut.includes(l)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(l,{slots:c,attrs:w}){let d;const x=B(null),i=N(()=>l.itemsSize>=0&&l.itemsFn!==void 0?parseInt(l.itemsSize,10):Array.isArray(l.items)?l.items.length:0),{virtualScrollSliceRange:q,localResetVirtualScroll:V,padVirtualScroll:u,onVirtualScrollEvt:z}=Pt({virtualScrollLength:i,getVirtualScrollTarget:A,getVirtualScrollEl:k}),s=N(()=>{if(i.value===0)return[];const C=(D,T)=>({index:q.value.from+T,item:D});return l.itemsFn===void 0?l.items.slice(q.value.from,q.value.to).map(C):l.itemsFn(q.value.from,q.value.to-q.value.from).map(C)}),g=N(()=>"q-virtual-scroll q-virtual-scroll"+(l.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(l.scrollTarget!==void 0?"":" scroll")),b=N(()=>l.scrollTarget!==void 0?{}:{tabindex:0});oe(i,()=>{V()}),oe(()=>l.scrollTarget,()=>{I(),$()});function k(){return x.value.$el||x.value}function A(){return d}function $(){d=it(k(),l.scrollTarget),d.addEventListener("scroll",z,Re.passive)}function I(){d!==void 0&&(d.removeEventListener("scroll",z,Re.passive),d=void 0)}function L(){let C=u(l.type==="list"?"div":"tbody",s.value.map(c.default));return c.before!==void 0&&(C=c.before().concat(C)),ut(c.after,C)}return Ue(()=>{V()}),ct(()=>{$()}),De(()=>{$()}),Ge(()=>{I()}),Xe(()=>{I()}),()=>{if(c.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return l.type==="__qtable"?$t({ref:x,class:"q-table__middle "+g.value},L()):Y(Wt[l.type],{...w,ref:x,class:[w.class,g.value],...b.value},L)}}});const Xt={__name:"AccountBanner",props:{accountId:{type:String}},emits:["load"],setup(l,{emit:c}){const w=l,d=c,x=B({id:void 0,createdDate:void 0,createdBy:void 0,lastModifiedDate:void 0,lastModifiedBy:void 0,deleted:void 0,order:void 0,name:void 0,cardNo:void 0,type:void 0,currency:void 0,openingBalance:void 0,balance:void 0,creditLimit:void 0,settlementDay:void 0,settlementDayEntryDate:void 0,entryPeriod:void 0,duePeriod:void 0,duePeriodType:void 0,includeInNetWorth:void 0}),i=Je();return oe(()=>[i.event,w.accountId],()=>Ot(w.accountId).then(q=>{x.value=q.data,d("load",q.data)}),{immediate:!0}),(q,V)=>(Q(),K(_t,{account:x.value},null,8,["account"]))}};const Kt={class:"expend"},Jt={class:"income"},Zt={class:"flex justify-between"},ea={class:"flex justify-between"},ta={class:"text-grey-6"},aa={key:0},la={key:1},oa={key:2},na={key:0},ra={key:1},sa={key:2},ia={class:"text-caption text-grey-6"},ca={class:"flex justify-center q-pt-md"},ua={__name:"TransactionMain",setup(l){const c=ft(),w=vt(),d=Dt(),x=Ct(),i=Je(),q=Rt(),V=B(null),u=B(c.params.accountId),z=B(c.params.budgetId),s=B({}),g=B("month"),b=B([]),k=B(!1),A=B({keyword:"",startDate:0,endDate:0,category:"",account:u.value,transactionType:"",budget:z.value}),$=N(()=>!u.value||u.value==s.value.id),I=N(()=>!A.value.keyword);N(()=>[x.scrollerOffset[0],x.scrollerOffset[1]+60]),x.storeScrollerOffset;const L=N(()=>u.value?s.value.type=="Credit"?160:110:50),C=a=>{const t={amount:0,expense:0,income:0,transfer:0};if(z.value)for(const r of a)r.amount<=0?t.expense=j(t.expense).add(r.amount):t.income=j(t.income).add(r.amount);else for(const r of a)r.type==le.Withdraw?t.expense=j(t.expense).add(r.amount):r.type==le.Transfer?u.value&&r.senderAccountId==u.value?t.transfer=j(t.transfer).subtract(r.amount):t.transfer=j(t.transfer).add(r.amount):r.type==le.Refund?t.expense=j(t.expense).add(r.amount):r.type==le.Deposit?t.income=j(t.income).add(r.amount):r.type==le.Reconcile?t.income=j(t.income).add(r.amount):r.type==le.InvestmentBuy?t.expense=j(t.expense).add(r.amount):r.type==le.InvestmentSell&&(t.income=j(t.income).add(r.amount));return t.amount=j(t.expense).add(t.income),t},D={dispose:(a,t)=>{const r=[],v={};for(const S of a){const e=ce(S.date).format(t);let n=v[e];n||(n=[],r.push({desc:e,amount:0,expense:0,income:0,transfer:0,transactions:n})),n.push(S),v[e]=n}for(const S of r)Object.assign(S,C(S.transactions));return r},credit:a=>{const t=(s.value.settlementDay||1)-(s.value.entryPeriod||0),r="YYYY\u5E74MM\u6708",v=ce(),S={};S[v.format(r)]="\uFF08\u672A\u51FA\u8D26\u5355\uFF09",S[v.subtract(1,"M").format(r)]="\uFF08\u672C\u671F\u8D26\u5355\uFF09";const e=[],n={};for(const o of a){let _=ce(o.date);_=_.date()<=t?_.subtract(1,"M"):_;const M=_.format(r);let m=n[M];if(!m){m=[],n[M]=m;const y=_.add(1,"M").format("MM\u6708"),O=S[M]||"";e.push({desc:`${M}${t+1}\u65E5-${y}${t}\u65E5${O}`,amount:0,expense:0,income:0,transfer:0,transactions:m})}m.push(o)}for(const o of e)Object.assign(o,C(o.transactions));return e},day:a=>D.dispose(a,"YYYY\u5E74MM\u6708DD\u65E5"),week:a=>D.dispose(a,"YYYY\u5E74ww\u5468"),month:a=>D.dispose(a,"YYYY\u5E74MM\u6708"),quarter:a=>D.dispose(a,"YYYY\u5E74Q\u5B63"),year:a=>D.dispose(a,"YYYY\u5E74")},T=a=>{if(!$.value)return;const t=A.value.startDate,r=t==0?[]:b.value,v=new Set;for(const S of b.value)!S.expand||v.add(S.desc);if(a!==!0)if(t==0){const S=g.value=="year"?"year":"quarter";A.value.startDate=ce().startOf(S).valueOf(),A.value.endDate=0}else A.value.startDate=ce(t).subtract(1,"y").valueOf(),A.value.endDate=ce(t).subtract(1,"d").valueOf();k.value=!0,wt({...A.value}).then(S=>{const e=D[g.value](S.data).map(n=>({...n,expand:v.has(n.desc)}));b.value=r.concat(e),k.value=!1})},J=()=>{A.value.startDate=0,T()},me=a=>{s.value=a,g.value=s.value.type=="Credit"?"credit":"month",J()},pe=a=>{if(u.value&&u.value!==a.senderAccountId&&u.value!==a.recipientAccountId)return;const t=D[g.value]([a])[0],r=b.value.find(v=>v.desc===t.desc);if(r){const v=[...r.transactions,...t.transactions];v.sort((S,e)=>S.date<e.date?1:S.date===e.date?S.createdDate<e.createdDate?1:S.createdDate===e.createdDate?0:-1:-1),Object.assign(r,D[g.value](v)[0])}else{const v=[...b.value,t];v.sort((S,e)=>S.desc<e.desc?1:S.desc===e.desc?0:-1),b.value=v}},de=a=>{const t=b.value.findIndex(r=>{const v=r.transactions.findIndex(S=>S.id===a.id);return v>-1?(r.transactions.splice(v,1),!0):!1});t>-1&&b.value[t].transactions.length===0&&b.value.splice(t,1),!(u.value&&u.value!==a.senderAccountId&&u.value!==a.recipientAccountId)&&pe(a)},Se=(a,t,r)=>{const v=[{label:"\u590D\u5236",icon:"content_copy",callback:U,params:["clone"]},{label:"\u590D\u5236\uFF08\u4FDD\u7559\u65F6\u95F4\uFF09",icon:"content_copy",callback:U,params:["copy"]},{label:"\u7F16\u8F91",icon:"edit",callback:U,params:["edit"]},{label:"\u9000\u6B3E",icon:"reply",callback:U,params:["refund"]},...!u.value||a.reconciled?[]:[{},{label:"\u5BF9\u8D26\u6B64\u4EA4\u6613\u4E4B\u524D\u6240\u6709\u4EA4\u6613",icon:"playlist_add_check",callback:re,params:[]}],{},{label:"\u5220\u9664",icon:"delete",callback:ye,params:[t,r],classes:"text-negative"}];d.bottomSheet({actions:v}).onOk(S=>S.callback(a,...S.params)).onCancel(()=>{}).onDismiss(()=>{})},ne=se((a,t,r)=>{kt(a.id,a.status===2?1:2).then(v=>{b.value[t].transactions[r].status=v.data.status})},500),we=se((a,t,r)=>{xt(a.id,!a.reconciled).then(v=>{b.value[t].transactions[r].reconciled=v.data.reconciled})},500),re=se(a=>{Tt(u.value,a.id).then(()=>T(!0))},1e3),U=se((a,t)=>{var r;return t==="edit"?(i.putEditData({...a}),w.push(`/transactions/${a.id}`)):(t==="add"?i.putEditData({type:"Withdraw",senderAccountId:u.value||((r=i.data)==null?void 0:r.senderAccountId)}):t==="clone"?i.putEditData({...a,id:void 0,date:new Date().getTime()}):t==="copy"?i.putEditData({...a,id:void 0}):t==="refund"&&i.putEditData({...a,id:void 0,desc:a.desc+"\u7684\u9000\u6B3E",originalAmount:-a.originalAmount}),w.push("/transactions/add"))},1e3),ye=se((a,t,r)=>{Mt(a.id).then(()=>{i.publish({id:a.id},qe.DELETED);const v=b.value[t];v.transactions.splice(r,1),v.transactions.length===0?b.value.splice(t,1):Object.assign(v,C(v.transactions))})},1e3),fe=se(()=>{d.loading.show(),Yt(u.value).then(a=>{d.notify("\u8D26\u6237\u5DF2\u5220\u9664"),q.publish({id:u.value},Qt.DELETED),V.value.goBack()}).catch(a=>{var t,r;d.notify({color:"negative",message:((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||"\u64CD\u4F5C\u7ED3\u679C-\u5931\u8D25"})}).finally(()=>d.loading.hide())},1e3);return oe(()=>A.value.keyword,J,{immediate:!0}),oe(()=>i.event,a=>{a.type===qe.ADDED?pe(a.data):a.type===qe.UPDATED&&de(a.data)}),De(()=>{const a=c.params.accountId,t=c.params.budgetId;if(!(!a&&!t)){if(a){if(!u.value||u.value==a)return}else if(t&&(!z.value||z.value==t))return;u.value=a,z.value=t,g.value=s.value.type=="Credit"?"credit":"month",A.value={keyword:"",startDate:0,endDate:0,category:"",account:u.value,transactionType:"",budget:z.value},J()}}),(a,t)=>{const r=Qe("nav-bar"),v=Qe("MainWrapperLayout"),S=mt("dompurify-html");return Q(),K(v,null,{default:p(()=>[f(Vt,null,{default:p(()=>[f(r,{ref_key:"navBarRef",ref:V,"show-back":!!u.value},Oe({btn:p(()=>[f(Ye,{flat:"",dense:"",icon:"add",onClick:t[1]||(t[1]=e=>R(U)({},"add"))})]),default:p(()=>[f(pt,{modelValue:A.value.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>A.value.keyword=e),clearable:"",dark:"",dense:"",standout:"",debounce:"500"},{before:p(()=>[f(Fe,{name:"search"})]),_:1},8,["modelValue"])]),_:2},[u.value?{name:"menu",fn:p(()=>[f(Ke,null,{default:p(()=>[ge((Q(),K(Te,{clickable:"",to:`/accounts/${u.value}`},{default:p(()=>[f(ee,null,{default:p(()=>[H("\u7F16\u8F91\u8D26\u6237")]),_:1})]),_:1},8,["to"])),[[He]]),f(Me),ge((Q(),K(Te,{clickable:"",onClick:R(fe)},{default:p(()=>[f(ee,{class:"text-negative"},{default:p(()=>[H("\u5220\u9664\u8D26\u6237")]),_:1})]),_:1},8,["onClick"])),[[He]])]),_:1})]),key:"0"}:void 0]),1032,["show-back"]),F("div",{style:Ne({paddingTop:`${L.value}px`})},null,4),(Q(!0),G($e,null,St(b.value,(e,n)=>(Q(),G($e,{key:e.desc},[f(gt,{label:e.desc,"model-value":e.expand,"onUpdate:modelValue":o=>e.expand=o,class:"border-top bg-white",style:Ne({position:"sticky",top:`${L.value+50}px`,"z-index":n+1})},Oe({_:2},[z.value?{name:"header",fn:p(()=>[f(ee,null,{default:p(()=>[f(ae,null,{default:p(()=>[H(E(e.desc),1)]),_:2},1024),f(ae,{caption:"",class:"flex q-gutter-x-md"},{default:p(()=>[F("div",Kt,"\u652F\uFF1A"+E(R(X)(e.expense)),1),F("div",Jt,"\u9000\uFF1A"+E(R(X)(e.income)),1)]),_:2},1024)]),_:2},1024),f(ee,{side:""},{default:p(()=>[f(ae,{class:ze(R(Ae)(e.amount))},{default:p(()=>[H(E(R(X)(e.amount)),1)]),_:2},1032,["class"])]),_:2},1024)]),key:"0"}:{name:"header",fn:p(()=>[f(ee,null,{default:p(()=>[f(ae,null,{default:p(()=>[H(E(e.desc),1)]),_:2},1024),f(ae,{caption:"",class:"flex q-gutter-x-md"},{default:p(()=>[F("div",{class:"expend"},"\u652F\uFF1A"+E(R(X)(e.expense)),1),F("div",{class:"income"},"\u6536\uFF1A"+E(R(X)(e.income)),1)]),_:2},1024)]),_:2},1024),f(ee,{side:""},{default:p(()=>[f(ae,{class:ze(R(Ae)(e.amount))},{default:p(()=>[H(E(R(X)(e.amount)),1)]),_:2},1032,["class"]),f(ae,{caption:""},{default:p(()=>[H(" \u8F6C\uFF1A"+E(R(X)(e.transfer)),1)]),_:2},1024)]),_:2},1024)]),key:"1"}]),1032,["label","model-value","onUpdate:modelValue","style"]),e.expand?(Q(),K(Gt,{key:0,class:"border-top",items:e.transactions,separator:""},{default:p(({item:o,index:_})=>[(Q(),K(Te,{key:_,dense:"",clickable:"",onClick:M=>Se(o,n,_),class:"q-py-sm"},{default:p(()=>[f(ee,null,{default:p(()=>[F("div",Zt,[F("div",null,E(o.desc),1),F("div",{class:ze(["money",R(Ae)(o.amount,o.type)])},E(R(X)(o.amount,o.type)),3)]),F("div",ea,[F("span",ta,E(R(Bt)(o.date)),1),F("div",null,[f(Le,{dense:"",outline:"",clickable:"",onClick:Ie(M=>R(ne)(o,n,_),["stop"]),color:o.status===2?"":"orange",label:o.status===2?"\u5DF2\u786E\u8BA4":"\u5F85\u786E\u8BA4"},null,8,["onClick","color","label"]),f(Le,{dense:"",outline:"",clickable:"",onClick:Ie(M=>R(we)(o,n,_),["stop"]),color:o.reconciled?"":"orange"},{default:p(()=>[H(E(o.reconciled?"\u5DF2":"\u672A")+"\u5BF9\u8D26 ",1)]),_:2},1032,["onClick","color"])])]),o.recipientAccountId?(Q(),G("div",aa,[H(E(o.senderAccountName)+" ",1),f(Fe,{name:"arrow_forward",color:"primary"}),H(" "+E(o.recipientAccountName),1)])):(Q(),G("div",la,E(o.senderAccountName),1)),o.categoryName||o.payeeName?(Q(),G("div",oa,[o.categoryName?(Q(),G("span",na,E(o.categoryName),1)):te("",!0),o.categoryName&&o.payeeName?(Q(),G("span",ra,"\xB7")):te("",!0),o.payeeName?(Q(),G("span",sa,E(o.payeeName),1)):te("",!0)])):te("",!0),ge(F("div",ia,null,512),[[S,o.notes&&o.notes.replaceAll(`
`,"<br>")]])]),_:2},1024)]),_:2},1032,["onClick"]))]),_:2},1032,["items"])):te("",!0)],64))),128)),f(Et,{expand:"",position:"top"},{default:p(()=>[f(zt,{class:"q-pa-none"},{default:p(()=>[f(At,null,{default:p(()=>[f(yt,{flat:"",class:"bg-white"},{default:p(()=>[u.value?(Q(),K(bt,{key:0,class:"text-subtitle1"},{default:p(()=>[f(Xt,{"account-id":u.value,onLoad:me},null,8,["account-id"])]),_:1})):te("",!0),f(Me),f(qt,{modelValue:g.value,"onUpdate:modelValue":[t[2]||(t[2]=e=>g.value=e),J],align:"justify","outside-arrows":"","mobile-arrows":""},{default:p(()=>[f(ie,{label:"\u65E5",name:"day"}),f(ie,{label:"\u5468",name:"week"}),s.value.type=="Credit"?(Q(),K(ie,{key:0,label:"\u8D26\u5355",name:"credit"})):te("",!0),f(ie,{label:"\u6708",name:"month"}),f(ie,{label:"\u5B63",name:"quarter"}),f(ie,{label:"\u5E74",name:"year"})]),_:1},8,["modelValue"]),f(Me)]),_:1})]),_:1})]),_:1})]),_:1}),ge(F("div",ca,[f(Ye,{loading:k.value,"loading-text":"\u52A0\u8F7D\u4E2D...",onClick:T},{default:p(()=>[H(" \u70B9\u51FB\u52A0\u8F7D\u66F4\u591A ")]),_:1},8,["loading"])],512),[[ht,I.value]])]),_:1})]),_:1})}}};var Da=dt(ua,[["__scopeId","data-v-0e283d93"]]);export{Da as default};
