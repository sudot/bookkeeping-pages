import{aY as O,w as W,B as G,r as m,a as E,ab as g,f as v,j as b,k as u,m as l,G as B,n as H,Q as J,q as h,t as N,Y as y,s as i,bu as K,E as X,F as Z,H as ee,W as te,a0 as ae,a2 as C,a3 as Q,V as le,v as ne,bk as w}from"./index.46a27899.js";import{Q as ue}from"./QField.e3e9fc47.js";import{Q as z,a as x}from"./QItemLabel.0564320f.js";import{Q as oe}from"./QBtnDropdown.37bf428f.js";import{Q as se}from"./QForm.143d2f76.js";import{Q as re}from"./QPage.7824d0da.js";import{C as de}from"./ClosePopup.084ab801.js";import{u as ie}from"./use-quasar.20dd07d7.js";import{u as pe,a as me,s as fe,B as M,d as ce}from"./budget.2007ba51.js";import{f as ge,a as ve}from"./payee.772acdd3.js";import{u as ye}from"./account.00e1e43f.js";import{u as Ve}from"./key.dfec5238.js";import"./selection.f172ea0a.js";import"./currency.9051c79a.js";import"./currency.es.c7e1cdbb.js";import"./account-group.879321a1.js";import"./transaction.45dcaa38.js";import"./account-group.3c4ddb1d.js";Object.freeze({ADDED:1,UPDATED:2,DELETED:3});const P=O("category",{state:()=>({event:{data:void 0,type:void 0},expenseCategories:[],expenseTreeNodes:[],incomeTreeNodes:[]}),getters:{},actions:{publish(f,s){this.event={data:f,type:s}},fetchCategories(){ge().then(f=>{const s={},c=[];f.data.forEach(n=>{if(n.parentId)return;const V={id:n.id,name:n.name,type:n.type,children:[]};s[n.id]=V,c.push(V)}),f.data.forEach(n=>{!n.parentId||s[n.parentId].children.push({id:n.id,name:n.name})});for(const n of Object.values(s))n.children.length===0&&n.children.push({...n,children:[]});this.expenseTreeNodes=c.filter(n=>n.type=="Expense"),this.expenseCategories=this.expenseTreeNodes.flatMap(n=>n.children),this.incomeTreeNodes=c.filter(n=>n.type=="Income")})}}}),L=P();W(()=>L.event,L.fetchCategories,{immediate:!0});const be={class:"flex justify-end full-width"},he=i("div",null,"\u3010\u5206\u644A\u91D1\u989D\u3011\u662F\u4E00\u6B21\u6027\u7684\uFF0C\u6BCF\u6B21\u4F7F\u7528\u5B8C\u4E4B\u540E\u5E94\u8BE5\u91CD\u65B0\u5F52\u96F6\u3002",-1),xe=i("div",null," \xA0\xA0\xA0\xA0\xA0\xA0 \u5728\u51FA\u73B0\u5927\u578B\u4E00\u6B21\u6027\u610F\u5916\u5F00\u652F\u65F6\uFF0C\u9884\u7B97\u4F1A\u53D7\u5230\u5F88\u5927\u51B2\u51FB\uFF0C\u5982\u679C\u6BCF\u6708\u3010\u9910\u996E\u3011 1000 \u5143\uFF0C\u4ECA\u5E74\u8FC7\u751F\u65E5\u60F3\u6446\u9152\u82B1\u4E86 1500 \u5143\uFF0C\u90A3\u4E48\u672A\u6765\u81F3\u5C11\u597D\u51E0\u4E2A\u6708\uFF0C\u9910\u996E\u9884\u7B97\u90FD\u662F\u8D1F\u6570\uFF0C\u6BCF\u4E2A\u6708\u4E00\u5F00\u59CB\u5C31\u662F\u8D85\u652F\u72B6\u6001\u3002 ",-1),De=i("div",null," \xA0\xA0\xA0\xA0\xA0\xA0 \u8FD9\u6837\u4E00\u6765\uFF0C\u9884\u7B97\u7684\u6307\u793A\u4F5C\u7528\u5C31\u6CA1\u6709\u610F\u4E49\u4E86\u3002 \u800C\u751F\u65E5\u6446\u9152\u662F\u4E00\u6B21\u6027\u610F\u5916\u5F00\u652F\uFF0C\u53C8\u4E0D\u80FD\u4FEE\u6539\u6BCF\u6708\u9884\u7B97\uFF0C\u6BD5\u7ADF\u4E5F\u4E0D\u662F\u6708\u6708\u90FD\u8981\u6446\u9152\u3002 ",-1),_e=i("div",null," \xA0\xA0\xA0\xA0\xA0\xA0 \u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u53EF\u4EE5\u5728\u3010\u5206\u644A\u91D1\u989D\u3011\u4E2D\u8BBE\u7F6E 1200 \u5143\uFF0C\u8FD9\u4E2A\u6708\u7684\u5269\u4F59\u9884\u7B97\u5C31\u662F 700 \u5143\uFF081000 + 1200 - 1500\uFF09\uFF0C\u800C\u4E0D\u662F -500\u3002\u7136\u540E\u5728\u540E\u9762\u7684 4 \u4E2A\u6708\uFF0C\u6BCF\u4E2A\u6708\u51CF\u5C0F\u3010\u5206\u644A\u91D1\u989D\u3011300 \u5143\u76F4\u5230 0 \u5143\uFF0C\u8FD9\u6837\u4E00\u6765\u6BCF\u4E2A\u6708\u7684\u9884\u7B97\u90FD\u662F\u6B63\u6570\uFF08700 \u5143\uFF09\u6709\u6307\u793A\u610F\u4E49\u30024 \u4E2A\u6708\u540E\u610F\u5916\u5F00\u652F\u7684\u5F71\u54CD\u4E5F\u88AB\u6D88\u5316\u6389\u4E86\u3002\u3010\u5206\u644A\u91D1\u989D\u3011\u56DE\u5F52 0 \u5143\uFF0C\u6BCF\u6708\u9884\u7B97 1000 \u5143\u4E5F\u6CA1\u6709\u88AB\u4FEE\u6539\uFF0C\u76F8\u5F53\u4E8E\u628A 1500 \u5143\u7684\u610F\u5916\u5F00\u652F\u5206\u644A\u5230 5 \u4E2A\u6708\u3002 ",-1),Be=i("div",null," \u3010\u6EDA\u52A8\u8BA1\u7B97\u3011\uFF1A\u672A\u4F7F\u7528\u5B8C\u7684\u9884\u7B97\u7EE7\u7EED\u7D2F\u8BA1\u5230\u4E0B\u4E00\u4E2A\u9884\u7B97\u5468\u671F\u3002 ",-1),Ce=i("div",null,"\u3010\u91CD\u65B0\u8BA1\u7B97\u3011\uFF1A\u672A\u4F7F\u7528\u5B8C\u7684\u9884\u7B97\u4E0D\u7D2F\u8BA1\u5230\u4E0B\u4E00\u4E2A\u9884\u7B97\u5468\u671F\u3002",-1),Ye={__name:"BudgetEdit",setup(f){const{id:s,titlePrefix:c}=Ve(G().params.budgetId),n=ie(),V=ye(),$=P(),k=pe(),D=m(null),p=m(!1),a=m({id:s,name:void 0,openingBalance:void 0,amount:void 0,currency:"CNY",repeatable:!0,startDate:new Date().getTime(),endDate:void 0,duration:1,durationUnits:"M",rollover:!0,carriedBalance:void 0,notes:void 0,accounts:[],categories:[],tags:[],payees:[]}),q=E(()=>V.treeNodes),R=E(()=>$.expenseTreeNodes),_=m(!1),S=[{value:"D",label:"\u65E5"},{value:"W",label:"\u5468"},{value:"M",label:"\u6708"},{value:"Y",label:"\u5E74"}];m([]);const I=m([]);s&&me(s).then(o=>{a.value={...a.value,...o.data}});const j=w(()=>{p.value=!0,fe({...a.value}).then(({data:o})=>{n.notify(`\u5DF2\u6210\u529F\u4FDD\u5B58\u9884\u7B97:${a.value.name}`),k.publish({id:o},M.ADDED),D.value.goBack()}).catch(o=>{var t,d;n.notify({type:"negative",message:((d=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:d.message)||"\u4FDD\u5B58\u9884\u7B97\u5931\u8D25"})}).finally(()=>p.value=!1)},1e3),A=w(()=>{p.value=!0,ce(s).then(()=>{n.notify(`\u5DF2\u5220\u9664\u9884\u7B97:${a.value.name}`),k.publish({id:s},M.DELETED),D.value.goBack()}).catch(o=>{var t,d;n.notify({type:"negative",message:((d=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:d.message)||"\u5220\u9664\u9884\u7B97\u5931\u8D25"})}).finally(()=>p.value=!1)},1e3);return ve().then(o=>I.value=o.data),(o,t)=>{const d=g("DeleteConfirmBtn"),F=g("nav-bar"),U=g("InputMultiTreeSelect"),Y=g("InputMultiListSelect"),T=g("InputDatePopup");return v(),b(re,null,{default:u(()=>[l(F,{ref_key:"navBarRef",ref:D},{btn:u(()=>[a.value.id?(v(),b(d,{key:0,loading:p.value,content:a.value.name,onClick:B(A)},null,8,["loading","content","onClick"])):H("",!0),l(J,{flat:"",round:"",icon:"save",loading:p.value,onClick:t[0]||(t[0]=e=>o.$refs.formRef.submit())},null,8,["loading"])]),default:u(()=>[h(N(B(c))+"\u9884\u7B97 ",1)]),_:1},512),l(se,{ref:"formRef",class:"q-pa-md q-gutter-y-md",greedy:"",onSubmit:B(j)},{default:u(()=>[l(y,{modelValue:a.value.name,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.name=e),"input-class":"text-right",prefix:"\u9884\u7B97\u540D\u79F0",dense:"","lazy-rules":"",rules:[e=>(e==null?void 0:e.length)||"\u8BF7\u8F93\u5165\u9884\u7B97\u540D\u79F0"]},null,8,["modelValue","rules"]),l(y,{modelValue:a.value.amount,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value.amount=e),"input-class":"text-right",prefix:"\u9884\u7B97\u91D1\u989D",type:"number",dense:"","lazy-rules":"",rules:[e=>e>0||"\u8BF7\u8F93\u5165\u9884\u7B97\u91D1\u989D"]},null,8,["modelValue","rules"]),l(U,{modelValue:a.value.accounts,"onUpdate:modelValue":t[3]||(t[3]=e=>a.value.accounts=e),"input-class":"text-right",prefix:"\u8D26\u6237",dense:"","lazy-rules":"",rules:[e=>(e==null?void 0:e.length)||"\u8BF7\u9009\u62E9\u8D26\u6237"],nodes:q.value},null,8,["modelValue","rules","nodes"]),l(U,{modelValue:a.value.categories,"onUpdate:modelValue":t[4]||(t[4]=e=>a.value.categories=e),"input-class":"text-right",prefix:"\u5206\u7C7B",dense:"","lazy-rules":"",rules:[e=>(e==null?void 0:e.length)||"\u8BF7\u9009\u62E9\u5206\u7C7B"],nodes:R.value},null,8,["modelValue","rules","nodes"]),l(Y,{modelValue:a.value.payees,"onUpdate:modelValue":t[5]||(t[5]=e=>a.value.payees=e),"input-class":"text-right",prefix:"\u5BF9\u8C61",dense:"",items:I.value},null,8,["modelValue","items"]),l(T,{modelValue:a.value.startDate,"onUpdate:modelValue":t[6]||(t[6]=e=>a.value.startDate=e),"input-class":"text-right",prefix:"\u5F00\u59CB\u65F6\u95F4",dense:"","lazy-rules":"",rules:[e=>(e==null?void 0:e.length)||"\u8BF7\u9009\u62E9\u5F00\u59CB\u65F6\u95F4"]},null,8,["modelValue","rules"]),l(ue,{prefix:"\u662F\u5426\u91CD\u590D",dense:""},{control:u(()=>[i("div",be,[l(K,{modelValue:a.value.repeatable,"onUpdate:modelValue":t[7]||(t[7]=e=>a.value.repeatable=e),dense:""},null,8,["modelValue"])])]),_:1}),a.value.repeatable?(v(),b(y,{key:0,modelValue:a.value.duration,"onUpdate:modelValue":t[8]||(t[8]=e=>a.value.duration=e),"input-class":"text-right",prefix:"\u9884\u7B97\u5468\u671F",type:"number",dense:"","lazy-rules":"",rules:[e=>e>0||"\u8BF7\u586B\u5199\u9884\u7B97\u5468\u671F",e=>{var r;return((r=a.value.durationUnits)==null?void 0:r.length)||"\u8BF7\u586B\u9009\u62E9\u9884\u7B97\u5468\u671F\u5355\u4F4D"}]},{append:u(()=>{var e;return[l(oe,{flat:"",label:((e=S.find(r=>r.value==a.value.durationUnits))==null?void 0:e.label)||"\u5468\u671F\u5355\u4F4D"},{default:u(()=>[l(z,null,{default:u(()=>[(v(),X(ee,null,Z(S,r=>ne(l(C,{key:r.value,clickable:"",onClick:Qe=>a.value.durationUnits=r.value},{default:u(()=>[l(Q,null,{default:u(()=>[h(N(r.label),1)]),_:2},1024)]),_:2},1032,["onClick"]),[[de]])),64))]),_:1})]),_:1},8,["label"])]}),_:1},8,["modelValue","rules"])):(v(),b(T,{key:1,modelValue:a.value.endDate,"onUpdate:modelValue":t[9]||(t[9]=e=>a.value.endDate=e),"input-class":"text-right",prefix:"\u7ED3\u675F\u65F6\u95F4",dense:"","lazy-rules":"",rules:[e=>(e==null?void 0:e.length)||"\u8BF7\u9009\u62E9\u7ED3\u675F\u65F6\u95F4"]},null,8,["modelValue","rules"])),l(y,{modelValue:a.value.carriedBalance,"onUpdate:modelValue":t[11]||(t[11]=e=>a.value.carriedBalance=e),"input-class":"text-right",prefix:"\u5206\u644A\u91D1\u989D",type:"number",dense:""},{append:u(()=>[l(te,{name:"help_outline",class:"cursor-pointer",onClick:t[10]||(t[10]=e=>_.value=!0)})]),_:1},8,["modelValue"]),l(y,{modelValue:a.value.notes,"onUpdate:modelValue":t[12]||(t[12]=e=>a.value.notes=e),"input-class":"text-right",prefix:"\u5907\u6CE8",type:"textarea",dense:"",rows:"3"},null,8,["modelValue"])]),_:1},8,["onSubmit"]),l(le,{modelValue:_.value,"onUpdate:modelValue":t[13]||(t[13]=e=>_.value=e),position:"bottom"},{default:u(()=>[l(ae,{class:"full-width q-py-md"},{default:u(()=>[l(z,null,{default:u(()=>[l(C,null,{default:u(()=>[l(Q,null,{default:u(()=>[l(x,null,{default:u(()=>[h("\u5206\u644A\u91D1\u989D")]),_:1}),l(x,{caption:""},{default:u(()=>[he,xe,De,_e]),_:1})]),_:1})]),_:1}),l(C,null,{default:u(()=>[l(Q,null,{default:u(()=>[l(x,null,{default:u(()=>[h("\u9884\u7B97\u91D1\u989D\u8BA1\u7B97\u65B9\u5F0F")]),_:1}),l(x,{caption:"",lines:"2"},{default:u(()=>[Be,Ce]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Ye as default};
